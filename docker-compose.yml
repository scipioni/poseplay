services:  
  pose:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: poseplay
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - DISPLAY=${DISPLAY:-}
      - XAUTHORITY=/tmp/.docker.xauth
    volumes:
      # Mount the package source code for development
      - .:/workspace/poseplay
      # Mount data directory for input/output
      - ./data:/workspace/data
      # Mount X11 socket for GUI applications
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Mount host's Xauthority for GUI access
      - /home/${USER:-root}/.Xauthority:/tmp/.docker.xauth:rw
      # Mount camera device if needed
      - /dev/video0:/dev/video0
      # history
      - ./runtime/bash_history:/root/.bash_history
    working_dir: /workspace/poseplay
    stdin_open: true
    tty: true
    network_mode: host
    devices:
      - /dev/video0:/dev/video0  # Camera access
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]